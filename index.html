<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra c·ª©u PCCC Pro - QCVN 06:2022 (Sƒê 1:2023)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #b91c1c;
            --sidebar-bg: #1e1f20;
            --sidebar-text: #e3e3e3;
            --bg: #ffffff;
            --card: #f0f4f9;
            --text: #1f1f1f;
            --border: #e5e7eb;
            --highlight: #fde047;
            --link: #0b57d0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow-y: auto;
            border-right: 1px solid #333;
        }
        
        .brand {
            padding: 20px;
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #c4c7c5;
            border-radius: 0 20px 20px 0;
            margin-right: 10px;
        }
        .menu-item:hover { background-color: #333; color: #fff; }
        .menu-item.active { background-color: #004a77; color: #c2e7ff; font-weight: 500; }
        .highlight-menu { color: #fbbf24 !important; font-weight: 600; }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex-grow: 1;
            padding: 20px 40px;
            overflow-y: auto;
            background: #fff;
        }

        .section { display: none; max-width: 950px; margin: 0 auto; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* INPUT CARD */
        .card {
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px; 
            margin-bottom: 20px;
        }

        .form-section-title {
            grid-column: 1 / -1;
            font-size: 13px;
            font-weight: 700;
            color: #b91c1c;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        label { 
            display: flex; 
            align-items: center;
            margin-bottom: 6px; 
            font-size: 14px; 
            font-weight: 500; 
            color: #3c4043; 
        }
        .label-note { font-size: 12px; color: #666; font-weight: 400; font-style: italic; margin-left: 4px; }
        
        /* INFO ICON STYLE */
        .info-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e8f0fe;
            color: var(--link);
            font-size: 11px;
            font-weight: bold;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            margin-left: 6px;
            cursor: pointer;
            border: 1px solid #d2e3fc;
            transition: all 0.2s;
        }
        .info-icon:hover {
            background: var(--link);
            color: #fff;
            transform: scale(1.1);
        }

        input, select {
            width: 100%; padding: 10px;
            border: 1px solid #dadce0; border-radius: 4px;
            font-size: 14px; transition: 0.2s;
            box-sizing: border-box;
        }
        input:focus, select:focus { border-color: #1a73e8; outline: 2px solid rgba(26,115,232,0.2); }

        .btn {
            background: #0b57d0; color: #fff;
            padding: 12px; border: none; border-radius: 24px;
            font-weight: 500; cursor: pointer; width: 100%;
            transition: background 0.2s;
            font-size: 15px;
        }
        .btn:hover { background: #0842a0; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }

        /* --- REPORT STYLES --- */
        .report-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .report-title { font-size: 16px; font-weight: 700; color: #1f1f1f; }
        .status-badge { font-size: 12px; padding: 4px 12px; border-radius: 16px; font-weight: 500; }
        .st-ok { background: #e6f4ea; color: #137333; }
        .st-warn { background: #fef7e0; color: #ea8600; }
        .st-err { background: #fce8e6; color: #c5221f; }
        .st-info { background: #e8f0fe; color: #1967d2; }

        .calc-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            color: #444746;
            border-left: 3px solid #0b57d0;
            margin-top: 10px;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        .report-table td {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            vertical-align: middle;
        }
        .report-label { color: #5f6368; font-size: 14px; }
        .report-val { font-weight: 600; color: #202124; font-size: 14px; text-align: right; }
        .val-highlight { color: #b91c1c; font-weight: 700; font-size: 15px; }

        /* TABLES FOR LOOKUP IN MAIN VIEW */
        .lookup-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .lookup-table th, .lookup-table td {
            border: 1px solid #e0e0e0;
            padding: 10px;
            text-align: left;
        }
        .lookup-table th {
            background-color: #f1f3f4;
            font-weight: 600;
            color: #444;
            vertical-align: middle;
        }
        .lookup-table tr:hover {
            background-color: #f8f9fa;
        }

        /* --- DOCUMENT VIEWER MODAL --- */
        .doc-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }
        
        .doc-modal {
            background: #f0f2f5;
            width: 95%; max-width: 1100px; height: 95vh;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }

        .doc-header {
            background: #fff;
            padding: 12px 24px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .doc-title { font-weight: 600; color: #444746; font-size: 14px; }
        .close-btn { cursor: pointer; padding: 8px; border-radius: 50%; border: none; background: none; }
        .close-btn:hover { background: #f1f3f4; }

        .doc-body {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 40px;
            align-items: center;
            background: #525659;
        }

        .citation-group {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-bottom: 40px;
            border-bottom: 2px dashed #777;
        }
        
        .citation-group-title {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            background: #333;
            padding: 8px 16px;
            border-radius: 4px;
            align-self: flex-start;
            position: sticky;
            top: 0;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .doc-page {
            background: #fff;
            width: 100%; 
            min-height: 1000px;
            padding: 50px 60px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            box-sizing: border-box;
            font-family: 'Merriweather', serif;
            font-size: 14px;
            line-height: 1.6;
            color: #202124;
            position: relative;
            margin-bottom: 20px;
        }

        /* --- STYLES CHO B·∫¢NG TRONG MODAL --- */
        .doc-page table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
            font-size: 13px;
        }
        .doc-page th, .doc-page td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        .doc-page th {
            font-weight: 700;
            text-align: center;
        }

        .doc-page-number {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            font-size: 12px; color: #9aa0a6; font-family: sans-serif;
        }
        
        .doc-page-header-text {
            position: absolute; top: 30px; right: 60px;
            font-size: 10px; color: #9aa0a6; text-transform: uppercase; font-family: sans-serif;
        }

        .page-label {
            position: absolute; top: -25px; left: 0;
            background: #444; color: #fff;
            padding: 4px 8px; border-radius: 4px 4px 0 0;
            font-size: 11px; font-family: sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .page-label.is-center { background: #b91c1c; font-weight: bold; }

        mark.highlight {
            background-color: rgba(253, 224, 71, 0.6);
            color: #000;
            padding: 2px 0;
            border-bottom: 2px solid #f59e0b;
        }
        
        .mini-cite-btn {
            background: #f1f3f4; border: 1px solid #dadce0;
            border-radius: 12px; padding: 2px 8px;
            font-size: 11px; cursor: pointer; margin-left: 6px;
            color: #1a73e8;
        }
        .mini-cite-btn:hover { background: #e8f0fe; }

        /* Custom Checkbox & Radio */
        .checkbox-wrapper {
            display: flex; align-items: center; cursor: pointer; user-select: none;
            margin-top: 5px;
        }
        .checkbox-wrapper input { position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0; }
        .checkmark {
            height: 20px; width: 20px; background-color: #fff; border: 2px solid #b91c1c;
            border-radius: 4px; margin-right: 10px; display: flex; align-items: center; justify-content: center;
        }
        .checkbox-wrapper input:checked ~ .checkmark { background-color: #b91c1c; }
        .checkmark:after { content: ""; display: none; width: 5px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); }
        .checkbox-wrapper input:checked ~ .checkmark:after { display: block; }

        .radio-group { display:flex; flex-direction:column; gap:10px; margin-bottom:15px; }
        .radio-option { display:flex; align-items:center; cursor:pointer; font-size:14px; padding:8px; border:1px solid #eee; border-radius:6px; transition:0.2s; }
        .radio-option:hover { background:#f5f5f5; }
        .radio-option input { width:auto; margin-right:10px; }
        .radio-option.selected { background:#e8f0fe; border-color:#1a73e8; font-weight:500; }

        /* Grid for Material Calc */
        .mat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        @media (max-width: 768px) { .mat-grid { grid-template-columns: 1fr 1fr; } }

        @media (max-width: 768px) {
            body { flex-direction: column; height: auto; overflow: visible; }
            .sidebar { width: 100%; height: auto; }
            .main-content { padding: 15px; }
            .form-grid { grid-template-columns: 1fr; gap: 10px; }
        }
        
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border: 1px solid #ddd; background: #fff; cursor: pointer; border-radius: 20px; font-weight: 500; }
        .tab-btn.active { background: #b91c1c; color: #fff; border-color: #b91c1c; }
    </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="brand"><span>üî•</span> PCCC PRO</div>
    
    <div style="padding: 15px 20px 5px; font-size: 11px; font-weight: 700; color: #8e918f;">C√îNG C·ª§ CH√çNH</div>
    <div class="menu-item active highlight-menu" onclick="showTab('tong-hop', this)">üìã T·ªïng h·ª£p & Ki·ªÉm tra</div>
    <div class="menu-item" onclick="showTab('khoang-chay', this)">üß± T√≠nh Khoang Ch√°y</div>
    <div class="menu-item" onclick="showTab('tham-duyet', this)">‚úÖ Di·ªán Th·∫©m Duy·ªát</div>
    <div class="menu-item" onclick="showTab('hang-chay-no', this)">‚ö†Ô∏è H·∫°ng Ch√°y N·ªï</div>
    <div class="menu-item" onclick="showTab('vat-lieu', this)">üß™ V·∫≠t li·ªáu (Ch, SK, CV)</div>
    <div class="menu-item" onclick="showTab('cau-kien', this)">üèóÔ∏è C·∫•u ki·ªán (Ph·ª• l·ª•c F)</div>
    <div class="menu-item" onclick="showTab('thang-bo', this)">ü™ú S·ªë & Lo·∫°i Thang b·ªô</div>
    <div class="menu-item" onclick="showTab('cua-ngan-chay', this)">üö™ C·ª≠a & B·ªô ph·∫≠n NgƒÉn ch√°y</div>
    <div class="menu-item" onclick="showTab('nha-cao-tang', this)">üè¢ Nh√† Cao T·∫ßng (>100m)</div>

    <div style="padding: 15px 20px 5px; font-size: 11px; font-weight: 700; color: #8e918f;">TRA C·ª®U NHANH</div>
    <div class="menu-item" onclick="showTab('nhom-nha', this)">üîç Nh√≥m nh√† (F)</div>
    <div class="menu-item" onclick="showTab('cong-nang-phong', this)">üè¢ Tra c·ª©u theo Ph√≤ng</div>
    <div class="menu-item" onclick="showTab('thoat-nan', this)">üèÉ Tho√°t n·∫°n</div>
    <div class="menu-item" onclick="showTab('duong-xe', this)">üöë B√£i ƒë·ªó & ƒê∆∞·ªùng xe</div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">

    <!-- DASHBOARD T·ªîNG H·ª¢P -->
    <div id="tong-hop" class="section active">
        <h2 style="margin-top:0">Ki·ªÉm tra & T√≠nh to√°n PCCC</h2>
        <div class="card">
            <div class="form-grid">
                <div>
                    <div class="form-section-title">1. Quy m√¥ c√¥ng tr√¨nh</div>
                    <div style="display: flex; gap: 15px;">
                        <div class="input-group" style="flex:1">
                            <label>Chi·ªÅu cao PCCC (m): <span class="info-icon" onclick='openDocViewer([{page:8, label:"M·ª•c 1.4.9", highlights:["Chi·ªÅu cao PCCC"]}])'>i</span></label>
                            <input type="number" id="inp-height" placeholder="ƒê·∫øn m√©p d∆∞·ªõi c·ª≠a s·ªï...">
                        </div>
                        <div class="input-group" style="flex:1">
                            <label>S·ªë t·∫ßng: <span class="info-icon" onclick='openDocViewer([{page:14, label:"M·ª•c 1.4.50", highlights:["S·ªë t·∫ßng nh√†"]}])'>i</span></label>
                            <input type="number" id="inp-floors" placeholder="G·ªìm c·∫£ h·∫ßm...">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Di·ªán t√≠ch x√¢y d·ª±ng (m¬≤):</label>
                        <input type="number" id="inp-build-area" placeholder="Di·ªán t√≠ch chi·∫øm ƒë·∫•t...">
                    </div>
                    <div class="input-group">
                        <label>Di·ªán t√≠ch s√†n 1 t·∫ßng (m¬≤):</label>
                        <input type="number" id="inp-area" placeholder="VD: 800">
                    </div>
                    <div class="input-group">
                        <label>Kh·ªëi t√≠ch nh√† (m¬≥): <span class="info-icon" onclick='openDocViewer([{page:13, label:"M·ª•c 1.4.47", highlights:["Quy m√¥ kh·ªëi t√≠ch"]}])'>i</span></label>
                        <input type="number" id="inp-volume" placeholder="T·ªïng kh·ªëi t√≠ch...">
                    </div>
                </div>
                <div>
                    <div class="form-section-title">2. C√¥ng nƒÉng & S·ª≠ d·ª•ng</div>
                    <div class="input-group">
                        <label>Lo·∫°i c√¥ng tr√¨nh:</label>
                        <select id="inp-function" onchange="toggleRiskInput()">
                            <option value="">-- Ch·ªçn --</option>
                            <option value="F1.3">F1.3 - Chung c∆∞</option>
                            <option value="F4.3">F4.3 - VƒÉn ph√≤ng</option>
                            <option value="F3.1">F3.1 - Th∆∞∆°ng m·∫°i</option>
                            <option value="F5.1">F5.1 - Nh√† x∆∞·ªüng</option>
                            <option value="F1.2">F1.2 - Kh√°ch s·∫°n</option>
                        </select>
                    </div>
                    <div id="risk-container" style="display:none;" class="input-group">
                        <label>H·∫°ng s·∫£n xu·∫•t (F5):</label>
                        <select id="inp-risk">
                            <option value="C">H·∫°ng C</option>
                            <option value="A">H·∫°ng A</option>
                            <option value="B">H·∫°ng B</option>
                            <option value="D">H·∫°ng D</option>
                            <option value="E">H·∫°ng E</option>
                        </select>
                    </div>
                    <div class="form-section-title" style="margin-top:20px">3. Tho√°t n·∫°n & KC An to√†n</div>
                    <div class="input-group">
                        <label>T·ªïng s·ªë ng∆∞·ªùi:</label>
                        <input type="number" id="inp-people" placeholder="VD: 150">
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <div class="input-group" style="flex:1">
                            <label>KC t·ªõi nh√† b√™n (m):</label>
                            <input type="number" id="inp-dist" placeholder="VD: 6">
                        </div>
                        <div class="input-group" style="flex:1">
                            <label>B·∫≠c ch·ªãu l·ª≠a nh√† b√™n:</label>
                            <select id="inp-neighbor-grade">
                                <option value="1">B·∫≠c I, II</option>
                                <option value="2">B·∫≠c III</option>
                                <option value="3">B·∫≠c IV, V</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top:15px; padding:10px; background:#e8f0fe; border-radius:6px; font-size:13px; border: 1px solid #d2e3fc;">
                        <span style="color:#1967d2; font-weight:bold">T·ª± ƒë·ªông x√°c ƒë·ªãnh s∆° b·ªô:</span><br>
                        B·∫≠c ch·ªãu l·ª≠a y√™u c·∫ßu: <span id="auto-grade-display" style="font-weight:bold; color:#b91c1c">---</span>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="runCheckAll()">T√çNH TO√ÅN & HI·ªÇN TH·ªä CƒÇN C·ª®</button>
        </div>
        <div id="report-container" style="display:none"></div>
    </div>

    <!-- NH√Ä CAO T·∫¶NG (>100M) - NEW TAB -->
    <div id="nha-cao-tang" class="section">
        <h2 style="margin-top:0">Quy ƒë·ªãnh b·ªï sung cho Nh√† si√™u cao t·∫ßng (>100m)</h2>
        <div class="card">
            <div class="form-section-title">B·∫£ng A.1 - B·∫≠c ch·ªãu l·ª≠a c√¥ng tr√¨nh C·∫•p 1 (100m < H < 150m)</div>
            <div style="font-size:13px; margin-bottom:10px; color:#555;">
                √Åp d·ª•ng cho c√°c c√¥ng tr√¨nh c√≥ chi·ªÅu cao PCCC t·ª´ 100m ƒë·∫øn 150m (tham kh·∫£o quy ƒë·ªãnh ƒë·∫∑c bi·ªát).
            </div>
            <table class="lookup-table">
                <thead>
                    <tr><th>C·∫•u ki·ªán / V·ªã tr√≠</th><th>Y√™u c·∫ßu Gi·ªõi h·∫°n ch·ªãu l·ª≠a (min)</th></tr>
                </thead>
                <tbody>
                    <tr><td><strong>B·ªô ph·∫≠n ch·ªãu l·ª±c (C·ªôt, V√°ch c·ª©ng, L√µi)</strong></td><td style="color:#b91c1c; font-weight:bold;">R 180 (C·ªôt/V√°ch)</td></tr>
                    <tr><td><strong>D·∫ßm ch·ªãu l·ª±c</strong></td><td style="color:#b91c1c; font-weight:bold;">R 120</td></tr>
                    <tr><td><strong>S√†n gi·ªØa c√°c t·∫ßng</strong></td><td style="color:#b91c1c; font-weight:bold;">REI 120</td></tr>
                    <tr><td><strong>T∆∞·ªùng ngƒÉn ch√°y (gi·ªØa c√°c khoang)</strong></td><td style="color:#b91c1c; font-weight:bold;">REI 180</td></tr>
                    <tr><td><strong>T∆∞·ªùng ngƒÉn gi·ªØa c√°c cƒÉn h·ªô</strong></td><td style="color:#b91c1c; font-weight:bold;">EI 90</td></tr>
                    <tr><td><strong>T∆∞·ªùng ngƒÉn cƒÉn h·ªô v·ªõi h√†nh lang</strong></td><td style="color:#b91c1c; font-weight:bold;">EI 60</td></tr>
                    <tr><td><strong>T∆∞·ªùng ngƒÉn s·∫£nh thang m√°y</strong></td><td style="color:#b91c1c; font-weight:bold;">EI 60</td></tr>
                    <tr><td><strong>T∆∞·ªùng ph√≤ng k·ªπ thu·∫≠t (bi·∫øn √°p, m√°y ph√°t)</strong></td><td style="color:#b91c1c; font-weight:bold;">EI 120 (ho·∫∑c EI 90 t√πy v·ªã tr√≠)</td></tr>
                    <tr><td><strong>T∆∞·ªùng ngƒÉn kho h√†ng, l∆∞u tr·ªØ</strong></td><td style="color:#b91c1c; font-weight:bold;">EI 120</td></tr>
                </tbody>
            </table>
            <div style="margin-top:10px; text-align:right;">
                <button class="mini-cite-btn" onclick="openDocViewer([{page:'DOC_A1', label:'B·∫£ng A.1 - Nh√† cao t·∫ßng > 100m'}])">üìñ Xem ngu·ªìn chi ti·∫øt</button>
            </div>
        </div>
    </div>

    <!-- C·∫§U KI·ªÜN & K·∫æT C·∫§U (PH·ª§ L·ª§C F) -->
    <div id="cau-kien" class="section">
        <h2 style="margin-top:0">C·∫•u ki·ªán & Gi·ªõi h·∫°n ch·ªãu l·ª≠a</h2>
        
        <div class="tab-buttons">
            <div class="tab-btn active" onclick="switchSubTab(this, 'tab-req-struct')">1. Y√™u c·∫ßu (B·∫£ng 4)</div>
            <div class="tab-btn" onclick="switchSubTab(this, 'tab-check-struct')">2. Ki·ªÉm tra (Ph·ª• l·ª•c F)</div>
            <div class="tab-btn" onclick="openDocViewer([{page:'DOC_GLOSSARY', label:'ƒê·ªãnh nghƒ©a & Kh√°i ni·ªám R, E, I'}])">3. ƒê·ªãnh nghƒ©a (R, E, I)</div>
        </div>

        <!-- Subtab 1: Y√™u c·∫ßu theo B·∫≠c ch·ªãu l·ª≠a -->
        <div id="tab-req-struct">
            <div class="card">
                <div class="form-section-title">Y√™u c·∫ßu Gi·ªõi h·∫°n ch·ªãu l·ª≠a (B·∫£ng 4)</div>
                <div class="input-group">
                    <label>B·∫≠c ch·ªãu l·ª≠a c·ªßa nh√†: <span class="info-icon" onclick='openDocViewer([{page:26, label:"B·∫£ng 4 - Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·∫•u ki·ªán"}])'>i</span></label>
                    <select id="sel-struct-grade" onchange="calcStructureLimit()">
                        <option value="">-- Ch·ªçn B·∫≠c --</option>
                        <option value="I">B·∫≠c I</option>
                        <option value="II">B·∫≠c II</option>
                        <option value="III">B·∫≠c III</option>
                        <option value="IV">B·∫≠c IV</option>
                        <option value="V">B·∫≠c V</option>
                    </select>
                </div>
                <div id="struct-result" style="display:none; margin-top:20px;"></div>
            </div>
            <div class="card">
                <div class="form-section-title">Nguy√™n vƒÉn B·∫£ng 4 (QCVN 06:2022)</div>
                <div style="overflow-x: auto;">
                    <table class="lookup-table" style="min-width: 600px;">
                        <thead>
                            <tr>
                                <th rowspan="2" style="width:10%">B·∫≠c</th>
                                <th colspan="5">Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa c·∫•u ki·ªán x√¢y d·ª±ng (min)</th>
                            </tr>
                            <tr><th>Ch·ªãu l·ª±c (R)</th><th>T∆∞·ªùng ngo√†i (E)</th><th>S√†n (REI)</th><th>M√°i (RE)</th><th>T∆∞·ªùng thang (REI)</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>I</strong></td><td>R 120</td><td>E 30</td><td>REI 60</td><td>RE 30</td><td>REI 120</td></tr>
                            <tr><td><strong>II</strong></td><td>R 90</td><td>E 15</td><td>REI 45</td><td>RE 15</td><td>REI 90</td></tr>
                            <tr><td><strong>III</strong></td><td>R 45</td><td>E 15</td><td>REI 45</td><td>RE 15</td><td>REI 60</td></tr>
                            <tr><td><strong>IV</strong></td><td>R 15</td><td>E 15</td><td>REI 15</td><td>RE 15</td><td>REI 45</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Subtab 2: Ki·ªÉm tra theo Ph·ª• l·ª•c F -->
        <div id="tab-check-struct" style="display:none;">
            <div class="card">
                <div class="form-section-title">T√≠nh to√°n Gi·ªõi h·∫°n ch·ªãu l·ª≠a danh ƒë·ªãnh (Ph·ª• l·ª•c F)</div>
                <div class="form-grid">
                    <div class="input-group">
                        <label>Lo·∫°i c·∫•u ki·ªán:</label>
                        <select id="f-type" onchange="updateFMaterial()">
                            <option value="col">C·ªôt BTCT (B·∫£ng F.1)</option>
                            <option value="beam">D·∫ßm BTCT (B·∫£ng F.2)</option>
                            <option value="floor">S√†n BTCT (B·∫£ng F.3)</option>
                            <option value="wall_conc">T∆∞·ªùng BTCT (B·∫£ng F.4)</option>
                            <option value="wall_brick">T∆∞·ªùng g·∫°ch/kh·ªëi x√¢y (B·∫£ng F.5)</option>
                        </select>
                    </div>
                    
                    <!-- √î ch·ªçn ch·∫•t li·ªáu m·ªõi -->
                    <div class="input-group" id="group-f-mat">
                        <label>Ch·∫•t li·ªáu / ƒê·∫∑c ƒëi·ªÉm:</label>
                        <select id="f-material">
                            <!-- Populated by JS -->
                        </select>
                    </div>

                    <div class="input-group">
                        <label>K√≠ch th∆∞·ªõc c·∫°nh nh·ªè nh·∫•t / Chi·ªÅu d√†y (mm):</label>
                        <input type="number" id="f-dim" placeholder="V√≠ d·ª•: 300">
                    </div>
                    <div class="input-group" id="group-f-dist">
                        <label>Kho·∫£ng c√°ch t√¢m c·ªët th√©p (a) (mm): <span class="label-note">(T·ª´ b·ªÅ m·∫∑t ƒë·∫øn t√¢m th√©p)</span></label>
                        <input type="number" id="f-dist" placeholder="V√≠ d·ª•: 35">
                    </div>
                </div>
                <button class="btn" onclick="calcAppendixF()">KI·ªÇM TRA GI·ªöI H·∫†N CH·ªäU L·ª¨A</button>
                <div id="f-result" style="display:none; margin-top:20px;"></div>
            </div>
            
            <div class="card">
                <div class="form-section-title">Tra c·ª©u Ngu·ªìn Ph·ª• l·ª•c F</div>
                <div style="display:flex; flex-wrap:wrap; gap:10px;">
                    <button class="mini-cite-btn" onclick="openDocViewer([{page:'PL_F1', label:'B·∫£ng F.1 - C·ªôt BTCT'}])">üìñ B·∫£ng F.1 (C·ªôt)</button>
                    <button class="mini-cite-btn" onclick="openDocViewer([{page:'PL_F2', label:'B·∫£ng F.2 - D·∫ßm BTCT'}])">üìñ B·∫£ng F.2 (D·∫ßm)</button>
                    <button class="mini-cite-btn" onclick="openDocViewer([{page:'PL_F3', label:'B·∫£ng F.3 - S√†n BTCT'}])">üìñ B·∫£ng F.3 (S√†n)</button>
                    <button class="mini-cite-btn" onclick="openDocViewer([{page:'PL_F4', label:'B·∫£ng F.4 - T∆∞·ªùng BTCT'}])">üìñ B·∫£ng F.4 (T∆∞·ªùng BTCT)</button>
                    <button class="mini-cite-btn" onclick="openDocViewer([{page:'PL_F5', label:'B·∫£ng F.5 - T∆∞·ªùng g·∫°ch'}])">üìñ B·∫£ng F.5 (T∆∞·ªùng g·∫°ch)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- C·ª¨A & NGƒÇN CH√ÅY (TAB) -->
    <div id="cua-ngan-chay" class="section">
        <h2 style="margin-top:0">Gi·ªõi h·∫°n ch·ªãu l·ª≠a C·ª≠a & B·ªô ph·∫≠n ngƒÉn ch√°y (B·∫£ng 2)</h2>
        <div class="card">
            <div class="form-section-title">X√°c ƒë·ªãnh Y√™u c·∫ßu C·ª≠a/Van ngƒÉn ch√°y</div>
            <div class="input-group">
                <label>V·ªã tr√≠ l·∫Øp ƒë·∫∑t (B·ªô ph·∫≠n ngƒÉn ch√°y): <span class="info-icon" onclick='openDocViewer([{page:28, label:"B·∫£ng 2 - Gi·ªõi h·∫°n ch·ªãu l·ª≠a b·ªô ph·∫≠n ch√®n b·ªãt"}])'>i</span></label>
                <select id="sel-barrier-type" onchange="calcDoorFireLimit()">
                    <option value="">-- Ch·ªçn v·ªã tr√≠ --</option>
                    <option value="W1">T∆∞·ªùng ngƒÉn ch√°y Lo·∫°i 1 (REI 150)</option>
                    <option value="W2">T∆∞·ªùng ngƒÉn ch√°y Lo·∫°i 2 (REI 60)</option>
                    <option value="P1">V√°ch ngƒÉn ch√°y Lo·∫°i 1 (EI 45)</option>
                    <option value="P2">V√°ch ngƒÉn ch√°y Lo·∫°i 2 (EI 15)</option>
                    <option value="F1">S√†n ngƒÉn ch√°y Lo·∫°i 1 (REI 150)</option>
                    <option value="F2">S√†n ngƒÉn ch√°y Lo·∫°i 2 (REI 60)</option>
                    <option value="F3">S√†n ngƒÉn ch√°y Lo·∫°i 3 (REI 45)</option>
                    <option value="F4">S√†n ngƒÉn ch√°y Lo·∫°i 4 (REI 15)</option>
                </select>
            </div>
            <div id="door-result" style="display:none; margin-top:20px;"></div>
        </div>
        <div class="card">
            <div class="form-section-title">B·∫£ng 2 - Gi·ªõi h·∫°n ch·ªãu l·ª≠a b·ªô ph·∫≠n ch√®n b·ªãt (Tr√≠ch QCVN 06:2022)</div>
            <table class="lookup-table">
                <thead><tr><th>B·ªô ph·∫≠n ngƒÉn ch√°y</th><th>Lo·∫°i b·ªô ph·∫≠n ch√®n b·ªãt</th><th>Gi·ªõi h·∫°n (min)</th></tr></thead>
                <tbody>
                    <tr><td>T∆∞·ªùng ngƒÉn ch√°y Lo·∫°i 1</td><td>Lo·∫°i 1</td><td>EI 60</td></tr>
                    <tr><td>T∆∞·ªùng ngƒÉn ch√°y Lo·∫°i 2</td><td>Lo·∫°i 2</td><td>EI 30</td></tr>
                    <tr><td>V√°ch ngƒÉn ch√°y Lo·∫°i 1</td><td>Lo·∫°i 2</td><td>EI 30</td></tr>
                    <tr><td>V√°ch ngƒÉn ch√°y Lo·∫°i 2</td><td>Lo·∫°i 3</td><td>EI 15</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- S·ªê & LO·∫†I THANG B·ªò (TAB) -->
    <div id="thang-bo" class="section">
        <h2 style="margin-top:0">T√≠nh to√°n S·ªë l∆∞·ª£ng & Lo·∫°i Bu·ªìng thang b·ªô</h2>
        <div class="card">
            <div class="form-section-title">Th√¥ng s·ªë c√¥ng tr√¨nh</div>
            <div class="form-grid">
                <div class="input-group">
                    <label>Chi·ªÅu cao PCCC (m): <span class="info-icon" onclick='openDocViewer([{page:8, label:"M·ª•c 1.4.9 - ƒê·ªãnh nghƒ©a chi·ªÅu cao PCCC"}])'>i</span></label>
                    <input type="number" id="thang-h" placeholder="VD: 30">
                </div>
                <div class="input-group">
                    <label>Nh√≥m nh√† (C√¥ng nƒÉng):</label>
                    <select id="thang-func">
                        <option value="F1.3">F1.3 - Nh√† chung c∆∞</option>
                        <option value="public">C√¥ng c·ªông (VP, Kh√°ch s·∫°n, TTTM...)</option>
                        <option value="F5">S·∫£n xu·∫•t, Kho</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Di·ªán t√≠ch t·∫ßng (m¬≤): <span class="label-note">(ƒê·ªÉ check ƒëi·ªÅu ki·ªán 1 thang)</span></label>
                    <input type="number" id="thang-area" placeholder="VD: 400">
                </div>
            </div>
            <button class="btn" onclick="calcStaircase()">X√ÅC ƒê·ªäNH LO·∫†I & S·ªê L∆Ø·ª¢NG THANG</button>
            <div id="thang-result" style="display:none; margin-top:20px;"></div>
        </div>
        <div class="card">
            <div class="form-section-title">Quy ƒë·ªãnh v·ªÅ Lo·∫°i bu·ªìng thang b·ªô (M·ª•c 2.5) <span class="info-icon" onclick='openDocViewer([{page:23, label:"M·ª•c 2.5 - Ph√¢n lo·∫°i bu·ªìng thang b·ªô"}])'>i</span></div>
            <table class="lookup-table">
                <thead><tr><th width="10%">Lo·∫°i</th><th>ƒê·∫∑c ƒëi·ªÉm k·ªπ thu·∫≠t</th></tr></thead>
                <tbody>
                    <tr><td style="color:#137333; font-weight:bold">L1</td><td>L·∫•y s√°ng qua c·ª≠a s·ªï tr√™n t∆∞·ªùng ngo√†i.</td></tr>
                    <tr><td style="color:#137333; font-weight:bold">L2</td><td>L·∫•y s√°ng qua gi·∫øng tr·ªùi tr√™n m√°i.</td></tr>
                    <tr><td style="color:#b91c1c; font-weight:bold">N1</td><td>V√†o thang qua kho·∫£ng h·ªü b√™n ngo√†i (Logia/Ban c√¥ng).</td></tr>
                    <tr><td style="color:#ea8600; font-weight:bold">N2</td><td>C√≥ √°p su·∫•t kh√¥ng kh√≠ d∆∞∆°ng (TƒÉng √°p tr·ª±c ti·∫øp).</td></tr>
                    <tr><td style="color:#ea8600; font-weight:bold">N3</td><td>V√†o thang qua khoang ƒë·ªám c√≥ √°p su·∫•t d∆∞∆°ng.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- T√çNH CH·∫§T V·∫¨T LI·ªÜU (TAB) -->
    <div id="vat-lieu" class="section">
        <h2 style="margin-top:0">T√≠nh ch·∫•t ch√°y c·ªßa V·∫≠t li·ªáu (Ph·ª• l·ª•c B)</h2>
        <div class="card">
            <div class="form-section-title">X√°c ƒë·ªãnh C·∫•p nguy hi·ªÉm ch√°y (CV)</div>
            <div class="mat-grid">
                <div class="input-group">
                    <label>T√≠nh ch√°y (Ch):</label>
                    <select id="sel-ch">
                        <option value="KC">KC - Kh√¥ng ch√°y</option>
                        <option value="Ch1">Ch1 - √çt ch√°y</option>
                        <option value="Ch2">Ch2 - Ch√°y v·ª´a</option>
                        <option value="Ch3">Ch3 - Ch√°y m·∫°nh</option>
                        <option value="Ch4">Ch4 - D·ªÖ ch√°y</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>B·∫Øt ch√°y (B):</label>
                    <select id="sel-b">
                        <option value="B1">B1 - Kh√≥ b·∫Øt</option>
                        <option value="B2">B2 - V·ª´a ph·∫£i</option>
                        <option value="B3">B3 - D·ªÖ b·∫Øt</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Lan truy·ªÅn (L):</label>
                    <select id="sel-l">
                        <option value="L1">L1 - Kh√¥ng lan</option>
                        <option value="L2">L2 - Lan y·∫øu</option>
                        <option value="L3">L3 - Lan v·ª´a</option>
                        <option value="L4">L4 - Lan m·∫°nh</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Sinh kh√≥i (SK):</label>
                    <select id="sel-sk">
                        <option value="SK1">SK1 - Th·∫•p</option>
                        <option value="SK2">SK2 - V·ª´a</option>
                        <option value="SK3">SK3 - Cao</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>ƒê·ªôc t√≠nh (ƒêT):</label>
                    <select id="sel-dt">
                        <option value="DT1">ƒêT1 - Th·∫•p</option>
                        <option value="DT2">ƒêT2 - V·ª´a</option>
                        <option value="DT3">ƒêT3 - Cao</option>
                        <option value="DT4">ƒêT4 - R·∫•t cao</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="calcMaterialCV()">X√ÅC ƒê·ªäNH C·∫§P CV</button>
            <div id="cv-result" style="display:none; margin-top:20px;"></div>
        </div>
        <!-- B·∫¢NG TRA CHI TI·∫æT -->
        <div class="card">
            <div class="form-section-title">B·∫£ng B.6 - Ph√¢n c·∫•p nguy hi·ªÉm ch√°y (CV) <span class="info-icon" onclick='openDocViewer([{page:103, label:"B·∫£ng B.6 - Ph√¢n c·∫•p v·∫≠t li·ªáu"}])'>i</span></div>
            <table class="lookup-table">
                <thead><tr><th>C·∫•p (CV)</th><th>T√≠nh ch√°y</th><th>B·∫Øt ch√°y</th><th>Lan truy·ªÅn</th><th>Sinh kh√≥i</th><th>ƒê·ªôc t√≠nh</th></tr></thead>
                <tbody>
                    <tr><td><strong>CV0</strong></td><td colspan="5" style="text-align:center">V·∫≠t li·ªáu kh√¥ng ch√°y</td></tr>
                    <tr><td><strong>CV1</strong></td><td>Ch1</td><td>B1</td><td>L1</td><td>SK1</td><td>ƒêT1</td></tr>
                    <tr><td><strong>CV2</strong></td><td>Ch1</td><td>B1</td><td>L1</td><td>SK2</td><td>ƒêT2</td></tr>
                    <tr><td><strong>CV3</strong></td><td>Ch2</td><td>B2</td><td>L2</td><td>SK2</td><td>ƒêT3</td></tr>
                    <tr><td><strong>CV4</strong></td><td>Ch3</td><td>B3</td><td>L3</td><td>SK3</td><td>ƒêT4</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- H·∫†NG CH√ÅY N·ªî (TAB) -->
    <div id="hang-chay-no" class="section">
        <h2 style="margin-top:0">X√°c ƒë·ªãnh H·∫°ng Nguy hi·ªÉm Ch√°y n·ªï (Ph·ª• l·ª•c C)</h2>
        <div class="card">
            <div class="form-section-title">C√¥ng c·ª• x√°c ƒë·ªãnh nhanh</div>
            <div class="radio-group" id="hazard-quiz">
                <label class="radio-option" onclick="selectRadio(this)"><input type="radio" name="hazard_q" value="A"><div><strong>Nh√≥m 1: A (Kh√≠ ch√°y, l·ªèng t &le; 28¬∞C)</strong></div></label>
                <label class="radio-option" onclick="selectRadio(this)"><input type="radio" name="hazard_q" value="B"><div><strong>Nh√≥m 2: B (B·ª•i/S·ª£i, l·ªèng t > 28¬∞C)</strong></div></label>
                <label class="radio-option" onclick="selectRadio(this)"><input type="radio" name="hazard_q" value="C"><div><strong>Nh√≥m 3: C (Ch·∫•t r·∫Øn/l·ªèng ch√°y)</strong></div></label>
                <label class="radio-option" onclick="selectRadio(this)"><input type="radio" name="hazard_q" value="D"><div><strong>Nh√≥m 4: D (N√≥ng ch·∫£y, ph√°t tia l·ª≠a)</strong></div></label>
                <label class="radio-option" onclick="selectRadio(this)"><input type="radio" name="hazard_q" value="E"><div><strong>Nh√≥m 5: E (V·∫≠t li·ªáu ngu·ªôi)</strong></div></label>
            </div>
            <button class="btn" onclick="calcHazardClass()">X√ÅC ƒê·ªäNH H·∫†NG</button>
            <div id="hazard-result" style="display:none; margin-top:20px;"></div>
        </div>
    </div>

    <!-- T√çNH KHOANG CH√ÅY (TAB) -->
    <div id="khoang-chay" class="section">
        <h2 style="margin-top:0">T√≠nh to√°n & Tra c·ª©u Khoang Ch√°y (Ph·ª• l·ª•c H)</h2>
        <div class="card">
            <div class="form-section-title">Nh·∫≠p th√¥ng s·ªë c√¥ng tr√¨nh</div>
            <div class="form-grid">
                <div class="input-group">
                    <label>Nh√≥m nh√† (C√¥ng nƒÉng):</label>
                    <select id="sel-kc-func" onchange="toggleKcRisk()">
                        <option value="F1.3">F1.3 - Chung c∆∞</option>
                        <option value="F1.2">F1.2 - Kh√°ch s·∫°n</option>
                        <option value="F2">F2 - VƒÉn h√≥a</option>
                        <option value="F3">F3 - Th∆∞∆°ng m·∫°i</option>
                        <option value="F4">F4 - VƒÉn ph√≤ng</option>
                        <option value="F5.1">F5.1 - S·∫£n xu·∫•t</option>
                        <option value="F5.2">F5.2 - Kho</option>
                    </select>
                </div>
                <div id="kc-risk-group" class="input-group" style="display:none">
                    <label>H·∫°ng nguy hi·ªÉm (F5):</label>
                    <select id="sel-kc-risk">
                        <option value="A">H·∫°ng A</option><option value="B">H·∫°ng B</option>
                        <option value="C">H·∫°ng C</option><option value="D">H·∫°ng D</option><option value="E">H·∫°ng E</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>B·∫≠c ch·ªãu l·ª≠a:</label>
                    <select id="sel-kc-grade">
                        <option value="I">B·∫≠c I</option><option value="II">B·∫≠c II</option>
                        <option value="III">B·∫≠c III</option><option value="IV">B·∫≠c IV</option><option value="V">B·∫≠c V</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>S·ªë t·∫ßng:</label>
                    <input type="number" id="inp-kc-floors" value="1" min="1">
                </div>
                <div class="input-group" style="align-self: flex-end;">
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="chk-sprinkler">
                        <span class="checkmark"></span>
                        <span style="font-weight: 500; font-size:14px; color:#b91c1c;">C√≥ Sprinkler?</span>
                    </label>
                </div>
            </div>
            <button class="btn" onclick="calcKhoangChay()">TRA C·ª®U KHOANG CH√ÅY</button>
        </div>
        <div id="kc-result" style="display:none"></div>
    </div>

    <!-- T√çNH TH·∫®M DUY·ªÜT PCCC (TAB) -->
    <div id="tham-duyet" class="section">
        <h2 style="margin-top:0">Ki·ªÉm tra ƒê·ªëi t∆∞·ª£ng Th·∫©m duy·ªát PCCC</h2>
        <div class="card">
            <div class="form-section-title">Th√¥ng tin c√¥ng tr√¨nh</div>
            <div class="form-grid">
                <div class="input-group">
                    <label>Lo·∫°i h√¨nh c√¥ng tr√¨nh:</label>
                    <select id="td-type">
                        <option value="apartment">Chung c∆∞, t·∫≠p th·ªÉ</option>
                        <option value="office">VƒÉn ph√≤ng</option>
                        <option value="hotel">Kh√°ch s·∫°n</option>
                        <option value="school">Tr∆∞·ªùng h·ªçc</option>
                        <option value="hospital">B·ªánh vi·ªán</option>
                        <option value="market">Ch·ª£, TTTM</option>
                        <option value="karaoke">Karaoke, Bar</option>
                        <option value="factory_ab">Nh√† x∆∞·ªüng (A, B)</option>
                        <option value="factory_cde">Nh√† x∆∞·ªüng (C, D, E)</option>
                        <option value="storage">Nh√† kho</option>
                        <option value="garage">Gara √¥ t√¥</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Cao (s·ªë t·∫ßng):</label>
                    <input type="number" id="td-floors" placeholder="VD: 5">
                </div>
                <div class="input-group">
                    <label>T·ªïng kh·ªëi t√≠ch (m¬≥):</label>
                    <input type="number" id="td-volume" placeholder="VD: 4000">
                </div>
            </div>
            <button class="btn" onclick="checkThamDuyet()">KI·ªÇM TRA NGAY</button>
        </div>
        <div id="td-result" style="display:none"></div>
    </div>

    <!-- TRA C·ª®U NHANH: C√îNG NƒÇNG PH√íNG -->
    <div id="cong-nang-phong" class="section">
        <h2 style="margin-top:0">Tra c·ª©u nhanh theo C√¥ng nƒÉng Ph√≤ng</h2>
        <div class="card">
            <div class="form-section-title">M·∫≠t ƒë·ªô & Tho√°t n·∫°n</div>
            <div class="input-group">
                <input type="text" id="search-room-func" onkeyup="filterTable('table-room-func', 'search-room-func')" placeholder="üîç Nh·∫≠p t√™n ph√≤ng...">
            </div>
            <table class="lookup-table" id="table-room-func">
                <thead><tr><th>Lo·∫°i ph√≤ng</th><th>H·ªá s·ªë s√†n (m¬≤/ng)</th><th>KC tho√°t n·∫°n Max (m)</th></tr></thead>
                <tbody>
                    <tr><td>VƒÉn ph√≤ng</td><td>6,0</td><td>50 (B·∫≠c I,II)</td></tr>
                    <tr><td>H·ªôi tr∆∞·ªùng</td><td>1,0</td><td>60 (B·∫≠c I,II)</td></tr>
                    <tr><td>S·∫£nh, Si√™u th·ªã</td><td>3,0</td><td>60 (B·∫≠c I,II)</td></tr>
                    <tr><td>Ph√≤ng ng·ªß (KS)</td><td>8,0</td><td>40 (Gi·ªØa 2 thang)</td></tr>
                    <tr><td>Kho</td><td>30,0</td><td>Theo B·∫£ng G.3</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- TRA C·ª®U NHANH: NH√ìM NH√Ä -->
    <div id="nhom-nha" class="section">
        <h2 style="margin-top:0">Tra c·ª©u Nh√≥m nh√† (F)</h2>
        <div class="card">
            <div class="input-group">
                <input type="text" id="search-nhom-nha" onkeyup="filterTable('table-nhom-nha', 'search-nhom-nha')" placeholder="üîç Nh·∫≠p m√£...">
            </div>
            <table class="lookup-table" id="table-nhom-nha">
                <thead><tr><th>M√£</th><th>M√¥ t·∫£</th><th>V√≠ d·ª•</th></tr></thead>
                <tbody>
                    <tr><td>F1.1</td><td>Nh√† tr·∫ª, b·ªánh vi·ªán</td><td>M·∫ßm non, BV n·ªôi tr√∫</td></tr>
                    <tr><td>F1.2</td><td>Kh√°ch s·∫°n</td><td>Kh√°ch s·∫°n, KTX</td></tr>
                    <tr><td>F1.3</td><td>Chung c∆∞</td><td>Chung c∆∞</td></tr>
                    <tr><td>F3.1</td><td>Th∆∞∆°ng m·∫°i</td><td>Si√™u th·ªã</td></tr>
                    <tr><td>F4.3</td><td>VƒÉn ph√≤ng</td><td>Tr·ª• s·ªü</td></tr>
                    <tr><td>F5.1</td><td>S·∫£n xu·∫•t</td><td>Nh√† m√°y</td></tr>
                    <tr><td>F5.2</td><td>Kho</td><td>Kho h√†ng</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- TRA C·ª®U NHANH: THO√ÅT N·∫†N -->
    <div id="thoat-nan" class="section">
        <h2 style="margin-top:0">Tra c·ª©u s·ªë li·ªáu Tho√°t n·∫°n</h2>
        <div class="card">
            <div class="form-section-title">S·ªë l∆∞·ª£ng l·ªëi tho√°t n·∫°n</div>
            <div class="form-grid">
                <div class="input-group">
                    <label>Nh√≥m:</label>
                    <select id="exit-calc-func"><option value="F1.3">F1.3</option><option value="Public">C√¥ng c·ªông</option></select>
                </div>
                <div class="input-group"><label>Cao (m):</label><input type="number" id="exit-calc-height"></div>
                <div class="input-group"><label>Di·ªán t√≠ch (m¬≤):</label><input type="number" id="exit-calc-area"></div>
                <div class="input-group"><label>S·ªë ng∆∞·ªùi:</label><input type="number" id="exit-calc-people"></div>
            </div>
            <button class="btn" onclick="checkExitCount()">KI·ªÇM TRA</button>
            <div id="exit-count-result" style="display:none; margin-top:15px"></div>
        </div>
        <div class="card">
            <div class="form-section-title">2. Chi·ªÅu r·ªông l·ªëi tho√°t n·∫°n t·ªëi thi·ªÉu (m)</div>
            <table class="lookup-table">
                <thead><tr><th>ƒê·ªëi t∆∞·ª£ng</th><th>S·ªë ng∆∞·ªùi</th><th>K√≠ch th∆∞·ªõc min</th></tr></thead>
                <tbody>
                    <tr><td>H√†nh lang, v·∫ø thang (F1.1)</td><td>> 15 ng∆∞·ªùi</td><td>1.2 m</td></tr>
                    <tr><td>H√†nh lang, v·∫ø thang (Kh√°c)</td><td>> 50 ng∆∞·ªùi</td><td>1.2 m</td></tr>
                    <tr><td>C·ª≠a ƒëi</td><td>-</td><td>0.8 m</td></tr>
                    <tr><td>C√°c l·ªëi ƒëi kh√°c</td><td>-</td><td>1.0 m</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- TRA C·ª®U NHANH: ƒê∆Ø·ªúNG XE -->
    <div id="duong-xe" class="section">
        <h2 style="margin-top:0">Tra c·ª©u B√£i ƒë·ªó & ƒê∆∞·ªùng cho xe ch·ªØa ch√°y</h2>
        <div class="card">
            <div class="form-grid">
                <div class="input-group"><label>R·ªông (m):</label><input type="number" id="check-road-width"></div>
                <div class="input-group"><label>Cao (m):</label><input type="number" id="check-road-height"></div>
            </div>
            <button class="btn" onclick="checkRoadAccess()">KI·ªÇM TRA</button>
            <div id="road-result" style="margin-top:10px; display:none" class="calc-box"></div>
        </div>
        <div class="card">
            <div class="form-section-title">Quy ƒë·ªãnh chung (QCVN 06:2022 - M·ª•c 6.2)</div>
            <table class="lookup-table">
                <thead><tr><th>Th√¥ng s·ªë</th><th>Y√™u c·∫ßu t·ªëi thi·ªÉu</th><th>CƒÉn c·ª©</th></tr></thead>
                <tbody>
                    <tr><td>Chi·ªÅu r·ªông m·∫∑t ƒë∆∞·ªùng</td><td><strong>3.5 m</strong></td><td>M·ª•c 6.2.1.1</td></tr>
                    <tr><td>Chi·ªÅu cao th√¥ng th·ªßy</td><td><strong>4.5 m</strong></td><td>M·ª•c 6.2.1.3</td></tr>
                    <tr><td>B√£i quay xe (ƒë∆∞·ªùng c·ª•t > 46m)</td><td>12 x 12 m</td><td>M·ª•c 6.2.5</td></tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- DOCUMENT VIEWER MODAL -->
<div id="doc-modal" class="doc-modal-overlay">
    <div class="doc-modal">
        <div class="doc-header">
            <div class="doc-title">üìÑ QCVN 06:2022/BXD & NGH·ªä ƒê·ªäNH 50</div>
            <button class="close-btn" onclick="closeDocViewer()">‚úï</button>
        </div>
        <div class="doc-body" id="doc-viewer-content"></div>
    </div>
</div>

<!-- JAVASCRIPT -->
<script>
    // --- DATABASE VƒÇN B·∫¢N (NGUY√äN VƒÇN) ---
    const qcvnPages = {
        8: `<div style="font-family: 'Times New Roman'; line-height: 1.5;"><p><strong>1.4.9. Chi·ªÅu cao ph√≤ng ch√°y ch·ªØa ch√°y</strong></p><p>Chi·ªÅu cao PCCC c·ªßa nh√† (kh√¥ng t√≠nh t·∫ßng k·ªπ thu·∫≠t tr√™n c√πng) ƒë∆∞·ª£c x√°c ƒë·ªãnh nh∆∞ sau: ...</p></div>`,
        26: `<div style="font-family: 'Times New Roman'; text-align: center;"><p><strong>B·∫£ng 4 ‚Äì Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa c√°c c·∫•u ki·ªán x√¢y d·ª±ng</strong></p><table border="1" style="width:100%; border-collapse:collapse; margin:auto;"><tr><th>B·∫≠c</th><th>B·ªô ph·∫≠n ch·ªãu l·ª±c (R)</th><th>T∆∞·ªùng ngo√†i (E)</th><th>S√†n (REI)</th><th>M√°i (RE)</th><th>T∆∞·ªùng thang (REI)</th></tr><tr><td>I</td><td>R 120</td><td>E 30</td><td>REI 60</td><td>RE 30</td><td>REI 120</td></tr><tr><td>II</td><td>R 90</td><td>E 15</td><td>REI 45</td><td>RE 15</td><td>REI 90</td></tr><tr><td>III</td><td>R 45</td><td>E 15</td><td>REI 45</td><td>RE 15</td><td>REI 60</td></tr><tr><td>IV</td><td>R 15</td><td>E 15</td><td>REI 15</td><td>RE 15</td><td>REI 45</td></tr></table></div>`,
        
        // --- D·ªÆ LI·ªÜU B·ªî SUNG T·ª™ DOCX (ƒê·ªäNH NGHƒ®A R, E, I) ---
        'DOC_GLOSSARY': `<div style="font-family:'Times New Roman'; line-height:1.6;">
            <h4 style="text-align:center;">ƒê·ªäNH NGHƒ®A GI·ªöI H·∫†N CH·ªäU L·ª¨A (THEO T√ÄI LI·ªÜU CUNG C·∫§P)</h4>
            <p><strong>2.3.2.</strong> Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa c·∫•u ki·ªán x√¢y d·ª±ng ƒë∆∞·ª£c x√°c ƒë·ªãnh b·∫±ng kho·∫£ng th·ªùi gian (t√≠nh b·∫±ng ph√∫t) k·ªÉ t·ª´ khi b·∫Øt ƒë·∫ßu th·ª≠ ch·ªãu l·ª≠a theo ch·∫ø ƒë·ªô nhi·ªát ti√™u chu·∫©n cho ƒë·∫øn khi xu·∫•t hi·ªán m·ªôt ho·∫∑c m·ªôt s·ªë d·∫•u hi·ªáu n·ªëi ti·∫øp nhau c·ªßa c√°c tr·∫°ng th√°i gi·ªõi h·∫°n ƒë∆∞·ª£c quy ƒë·ªãnh ƒë·ªëi v·ªõi c·∫•u ki·ªán ƒë√£ cho nh∆∞ sau:</p>
            <ul>
                <li><strong>M·∫•t kh·∫£ nƒÉng ch·ªãu l·ª±c (R):</strong> Kh·∫£ nƒÉng ch·ªãu l·ª±c b·ªã m·∫•t do s·∫≠p ƒë·ªï ho·∫∑c bi·∫øn d·∫°ng qu√° m·ª©c.</li>
                <li><strong>M·∫•t t√≠nh to√†n v·∫πn (E):</strong> Xu·∫•t hi·ªán v·∫øt n·ª©t ho·∫∑c l·ªó h·ªïng khi·∫øn ng·ªçn l·ª≠a ho·∫∑c kh√≠ n√≥ng c√≥ th·ªÉ xuy√™n qua.</li>
                <li><strong>M·∫•t kh·∫£ nƒÉng c√°ch nhi·ªát (I):</strong> Nhi·ªát ƒë·ªô b·ªÅ m·∫∑t kh√¥ng ti·∫øp x√∫c v·ªõi l·ª≠a tƒÉng qu√° m·ª©c quy ƒë·ªãnh.</li>
            </ul>
            <p><em>C√°c ti√™u chu·∫©n th·ª≠ nghi·ªám:</em></p>
            <ul>
                <li>C·∫•u ki·ªán x√¢y d·ª±ng: TCVN 9311-1:2012 ƒë·∫øn TCVN 9311-8:2012.</li>
                <li>·ªêng d·∫´n kh√≥i: ISO 6944.</li>
                <li>Van ngƒÉn ch√°y: ISO 10294.</li>
                <li>C·ª≠a ƒëi, c·ª≠a s·ªï: TCVN 9383:2012.</li>
            </ul>
        </div>`,

        // --- D·ªÆ LI·ªÜU B·ªî SUNG T·ª™ PDF (B·∫¢NG A.1 - NH√Ä CAO T·∫¶NG) ---
        'DOC_A1': `<div style="font-family:'Times New Roman'; line-height:1.6;">
            <h4 style="text-align:center;">B·∫¢NG A.1 - B·∫¨C CH·ªäU L·ª¨A C·ª¶A C√îNG TR√åNH C·∫§P 1<br>(Chi·ªÅu cao PCCC 100m - 150m)</h4>
            <p style="text-align:center;"><em>(Tr√≠ch t·ª´ t√†i li·ªáu: GIOI HAN CHIU LUA CAU KIEN.pdf)</em></p>
            <table border="1" style="width:100%; border-collapse:collapse; font-size:13px;">
                <tr><th style="background:#eee;">C·∫•u ki·ªán</th><th style="background:#eee;">Y√™u c·∫ßu Gi·ªõi h·∫°n ch·ªãu l·ª≠a</th></tr>
                <tr><td><strong>B·ªô ph·∫≠n ch·ªãu l·ª±c (C·ªôt, V√°ch c·ª©ng, L√µi c·ª©ng)</strong></td><td><strong>R 180</strong> (QCVN 06:2022 th√¥ng th∆∞·ªùng y√™u c·∫ßu R120 ho·∫∑c R150)</td></tr>
                <tr><td><strong>D·∫ßm ch·ªãu l·ª±c</strong></td><td><strong>R 120</strong></td></tr>
                <tr><td><strong>S√†n gi·ªØa c√°c t·∫ßng</strong></td><td><strong>REI 120</strong></td></tr>
                <tr><td><strong>M√°i ch·ªãu l·ª±c</strong></td><td><strong>RE 60</strong> (Th∆∞·ªùng l√† R60/RE60)</td></tr>
                <tr><td><strong>T∆∞·ªùng ngƒÉn ch√°y (gi·ªØa c√°c khoang ch√°y)</strong></td><td><strong>REI 180</strong> (Cao h∆°n m·ª©c REI 150 th√¥ng th∆∞·ªùng)</td></tr>
                <tr><td><strong>T∆∞·ªùng ngƒÉn c√°ch gi·ªØa c√°c cƒÉn h·ªô</strong></td><td><strong>EI 90</strong></td></tr>
                <tr><td><strong>T∆∞·ªùng ngƒÉn c√°ch cƒÉn h·ªô v·ªõi h√†nh lang</strong></td><td><strong>EI 60</strong></td></tr>
                <tr><td><strong>T∆∞·ªùng ngƒÉn s·∫£nh thang m√°y</strong></td><td><strong>EI (EIW) 60</strong></td></tr>
                <tr><td><strong>T∆∞·ªùng ngƒÉn bu·ªìng ƒë·ªám thang m√°y ch·ªØa ch√°y</strong></td><td><strong>EI 90</strong> (Th∆∞·ªùng y√™u c·∫ßu cao do t√≠nh an to√†n)</td></tr>
                <tr><td><strong>T∆∞·ªùng ph√≤ng k·ªπ thu·∫≠t (Bi·∫øn √°p, M√°y ph√°t)</strong></td><td><strong>EI 120</strong></td></tr>
                <tr><td><strong>T∆∞·ªùng ngƒÉn kho h√†ng, l∆∞u tr·ªØ</strong></td><td><strong>EI 120</strong></td></tr>
                <tr><td><strong>T∆∞·ªùng ph√≤ng d·ªãch v·ª• > 300m¬≤</strong></td><td><strong>EI 60</strong></td></tr>
            </table>
        </div>`,

        // D·ªØ li·ªáu Ph·ª• l·ª•c F
        'PL_F1': `<div style="font-family:'Times New Roman';"><h4 style="text-align:center">B·∫£ng F.1 ‚Äì Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa c·ªôt b√™ t√¥ng c·ªët th√©p</h4>
        <p><em>Ghi ch√∫: Gi√° tr·ªã trong b·∫£ng l√† (K√≠ch th∆∞·ªõc ti·∫øt di·ªán nh·ªè nh·∫•t b / Kho·∫£ng c√°ch ƒë·∫øn t√¢m c·ªët th√©p a) t√≠nh b·∫±ng mm.</em></p>
        <table border="1" style="width:100%;border-collapse:collapse;text-align:center">
            <tr><th rowspan="2">Gi·ªõi h·∫°n ch·ªãu l·ª≠a (ph√∫t)</th><th colspan="4">S·ªë m·∫∑t c·ªôt ti·∫øp x√∫c v·ªõi l·ª≠a</th></tr>
            <tr><th>1 m·∫∑t</th><th>2 m·∫∑t</th><th>3 m·∫∑t</th><th>4 m·∫∑t</th></tr>
            <tr><td>R 30</td><td>200/25</td><td>200/25</td><td>200/25</td><td>200/25</td></tr>
            <tr><td>R 60</td><td>200/25</td><td>200/25</td><td>250/35</td><td>300/30</td></tr>
            <tr><td>R 90</td><td>200/30</td><td>250/40</td><td>350/40</td><td>400/35</td></tr>
            <tr><td>R 120</td><td>250/35</td><td>350/45</td><td>350/45</td><td>450/40 (ho·∫∑c 400/45)</td></tr>
            <tr><td>R 180</td><td>350/45</td><td>350/60 (ho·∫∑c 450/55)</td><td>450/60</td><td>450/60</td></tr>
            <tr><td>R 240</td><td>400/60</td><td>-</td><td>-</td><td>-</td></tr>
        </table></div>`,
        
        'PL_F2': `<div style="font-family:'Times New Roman';"><h4 style="text-align:center">B·∫£ng F.2 ‚Äì Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa d·∫ßm b√™ t√¥ng c·ªët th√©p</h4>
        <table border="1" style="width:100%;border-collapse:collapse;text-align:center">
            <tr><th>Gi·ªõi h·∫°n ch·ªãu l·ª≠a</th><th>Chi·ªÅu r·ªông d·∫ßm b (mm)</th><th>Kho·∫£ng c√°ch a (mm)</th></tr>
            <tr><td>R 30</td><td>80</td><td>15</td></tr>
            <tr><td>R 60</td><td>120</td><td>30</td></tr>
            <tr><td>R 90</td><td>150</td><td>40</td></tr>
            <tr><td>R 120</td><td>200</td><td>50</td></tr>
            <tr><td>R 180</td><td>240</td><td>70</td></tr>
            <tr><td>R 240</td><td>280</td><td>85</td></tr>
        </table></div>`,
        
        'PL_F3': `<div style="font-family:'Times New Roman';"><h4 style="text-align:center">B·∫£ng F.3 ‚Äì Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa s√†n b√™ t√¥ng c·ªët th√©p</h4>
        <table border="1" style="width:100%;border-collapse:collapse;text-align:center">
            <tr><th>Gi·ªõi h·∫°n ch·ªãu l·ª≠a</th><th>Chi·ªÅu d√†y s√†n h (mm)</th><th>Kho·∫£ng c√°ch a (mm)</th></tr>
            <tr><td>REI 30</td><td>60</td><td>10</td></tr>
            <tr><td>REI 60</td><td>80</td><td>20</td></tr>
            <tr><td>REI 90</td><td>100</td><td>30</td></tr>
            <tr><td>REI 120</td><td>120</td><td>40</td></tr>
            <tr><td>REI 180</td><td>150</td><td>55</td></tr>
            <tr><td>REI 240</td><td>175</td><td>65</td></tr>
        </table></div>`,
        
        'PL_F4': `<div style="font-family:'Times New Roman';"><h4 style="text-align:center">B·∫£ng F.4 ‚Äì Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa t∆∞·ªùng b√™ t√¥ng c·ªët th√©p</h4>
        <table border="1" style="width:100%;border-collapse:collapse;text-align:center">
            <tr><th>Gi·ªõi h·∫°n ch·ªãu l·ª≠a</th><th>Chi·ªÅu d√†y t∆∞·ªùng h (mm)</th><th>Kho·∫£ng c√°ch a (mm)</th></tr>
            <tr><td>REI 30</td><td>100</td><td>10</td></tr>
            <tr><td>REI 60</td><td>120</td><td>25</td></tr>
            <tr><td>REI 90</td><td>140</td><td>35</td></tr>
            <tr><td>REI 120</td><td>160</td><td>45</td></tr>
            <tr><td>REI 180</td><td>200</td><td>55</td></tr>
            <tr><td>REI 240</td><td>240</td><td>65</td></tr>
        </table></div>`,
        
        'PL_F5': `<div style="font-family:'Times New Roman';"><h4 style="text-align:center">B·∫£ng F.5 ‚Äì Gi·ªõi h·∫°n ch·ªãu l·ª≠a c·ªßa t∆∞·ªùng g·∫°ch v√† kh·ªëi x√¢y</h4>
        <table border="1" style="width:100%;border-collapse:collapse;text-align:center">
            <tr>
                <th rowspan="2">Gi·ªõi h·∫°n ch·ªãu l·ª≠a (ph√∫t)</th>
                <th colspan="3">Chi·ªÅu d√†y t∆∞·ªùng (mm) t∆∞∆°ng ·ª©ng v·ªõi lo·∫°i v·∫≠t li·ªáu</th>
            </tr>
            <tr>
                <th>G·∫°ch ƒë·∫•t s√©t nung (Solid Clay)</th>
                <th>G·∫°ch Silicat (Sand-lime)</th>
                <th>B√™ t√¥ng nh·∫π / Kh√≠ ch∆∞ng √°p (AAC)</th>
            </tr>
            <tr><td>REI 30</td><td>110</td><td>110</td><td>100</td></tr>
            <tr><td>REI 60</td><td>110</td><td>110</td><td>100</td></tr>
            <tr><td>REI 90</td><td>110</td><td>220</td><td>150</td></tr>
            <tr><td>REI 120</td><td>220</td><td>220</td><td>150</td></tr>
            <tr><td>REI 180</td><td>220</td><td>330</td><td>200</td></tr>
            <tr><td>REI 240</td><td>330</td><td>-</td><td>200</td></tr>
        </table></div>`,

        'ND50_PL5': `<div style="font-family: 'Times New Roman'; line-height: 1.5;"><h4 style="text-align:center">PH·ª§ L·ª§C V - NGH·ªä ƒê·ªäNH 50/2024/Nƒê-CP</h4><p style="text-align:center"><strong>DANH M·ª§C D·ª∞ √ÅN, C√îNG TR√åNH THU·ªòC DI·ªÜN TH·∫®M DUY·ªÜT</strong></p><table border="1" style="width:100%; border-collapse:collapse;"><tr><th>STT</th><th>Lo·∫°i h√¨nh</th><th>Quy m√¥</th></tr><tr><td>1</td><td>Tr·ª• s·ªü c∆° quan</td><td>Cao ‚â• 7 t·∫ßng ho·∫∑c V ‚â• 5.000 m¬≥</td></tr><tr><td>2</td><td>Chung c∆∞, KTX</td><td>Cao ‚â• 7 t·∫ßng ho·∫∑c V ‚â• 5.000 m¬≥</td></tr><tr><td>16</td><td>Nh√† x∆∞·ªüng (A,B)</td><td>V ‚â• 1.500 m¬≥</td></tr></table></div>`
    };

    // --- LOGIC GIAO DI·ªÜN PH·ª§ L·ª§C F ---
    function updateFMaterial() {
        const type = document.getElementById('f-type').value;
        const matDiv = document.getElementById('group-f-mat');
        const matSel = document.getElementById('f-material');
        const distDiv = document.getElementById('group-f-dist');
        matSel.innerHTML = "";

        if (type === 'wall_brick') {
            matDiv.style.display = 'block';
            distDiv.style.display = 'none'; // T∆∞·ªùng g·∫°ch kh√¥ng c·∫ßn l·ªõp b·∫£o v·ªá c·ªët th√©p
            matSel.innerHTML = `
                <option value="clay">G·∫°ch ƒë·∫•t s√©t nung (Solid Clay)</option>
                <option value="silicate">G·∫°ch Silicat (Sand-lime)</option>
                <option value="aac">B√™ t√¥ng kh√≠ ch∆∞ng √°p / B√™ t√¥ng nh·∫π</option>
            `;
        } else {
            // C√°c lo·∫°i b√™ t√¥ng c·ªët th√©p
            matDiv.style.display = 'block';
            distDiv.style.display = 'block'; // C·∫ßn l·ªõp b·∫£o v·ªá
            matSel.innerHTML = `
                <option value="siliceous">C·ªët li·ªáu g·ªëc Silic (Th∆∞·ªùng)</option>
                <option value="calcareous">C·ªët li·ªáu g·ªëc Canxi/Cacbonat (T·ªët h∆°n)</option>
            `;
        }
    }

    // --- LOGIC PH·ª§ L·ª§C F (KI·ªÇM TRA C·∫§U KI·ªÜN) ---
    function calcAppendixF() {
        const type = document.getElementById('f-type').value;
        const mat = document.getElementById('f-material').value; // 'clay', 'aac', 'siliceous'...
        const dim = parseFloat(document.getElementById('f-dim').value) || 0;
        const dist = parseFloat(document.getElementById('f-dist').value) || 0;
        const resDiv = document.getElementById('f-result');
        resDiv.style.display = 'block';

        let rating = "Kh√¥ng ƒë·∫°t";
        let color = "#c5221f"; // red

        // Logic chi ti·∫øt h√≥a
        if (type === 'col') { // C·ªôt (4 ph√≠a - tr∆∞·ªùng h·ª£p ph·ªï bi·∫øn nh·∫•t)
            if (dim >= 450 && dist >= 60) rating = "R 240"; // X·∫•p x·ªâ
            else if (dim >= 450 && dist >= 60) rating = "R 180";
            else if (dim >= 400 && dist >= 45) rating = "R 120"; // Check k·ªπ l·∫°i b·∫£ng: 400/45 or 450/40
            else if (dim >= 400 && dist >= 35) rating = "R 90";
            else if (dim >= 300 && dist >= 30) rating = "R 60";
            else if (dim >= 200 && dist >= 25) rating = "R 30";
        } 
        else if (type === 'beam') { // D·∫ßm
            if (dim >= 280 && dist >= 85) rating = "R 240";
            else if (dim >= 240 && dist >= 70) rating = "R 180";
            else if (dim >= 200 && dist >= 50) rating = "R 120";
            else if (dim >= 150 && dist >= 40) rating = "R 90";
            else if (dim >= 120 && dist >= 30) rating = "R 60";
            else if (dim >= 80 && dist >= 15) rating = "R 30";
        } 
        else if (type === 'floor') { // S√†n
            if (dim >= 175 && dist >= 65) rating = "REI 240";
            else if (dim >= 150 && dist >= 55) rating = "REI 180";
            else if (dim >= 120 && dist >= 40) rating = "REI 120";
            else if (dim >= 100 && dist >= 30) rating = "REI 90";
            else if (dim >= 80 && dist >= 20) rating = "REI 60";
            else if (dim >= 60 && dist >= 10) rating = "REI 30";
        } 
        else if (type === 'wall_conc') { // T∆∞·ªùng BTCT
            if (dim >= 240 && dist >= 65) rating = "REI 240";
            else if (dim >= 200 && dist >= 55) rating = "REI 180";
            else if (dim >= 160 && dist >= 45) rating = "REI 120";
            else if (dim >= 140 && dist >= 35) rating = "REI 90";
            else if (dim >= 120 && dist >= 25) rating = "REI 60";
            else if (dim >= 100 && dist >= 10) rating = "REI 30";
        } 
        else if (type === 'wall_brick') { // T∆∞·ªùng g·∫°ch F.5
            if (mat === 'clay') { // ƒê·∫•t s√©t nung
                if (dim >= 330) rating = "REI 240";
                else if (dim >= 220) rating = "REI 180"; // C√≥ th·ªÉ REI 120 t√πy t·∫£i, b·∫£ng R180
                else if (dim >= 110) rating = "REI 90"; // G·∫°ch 110 th∆∞·ªùng ƒë∆∞·ª£c coi l√† REI 90 (EI90)
            } else if (mat === 'silicate') { // Silicat
                if (dim >= 330) rating = "REI 180";
                else if (dim >= 220) rating = "REI 120";
                else if (dim >= 110) rating = "REI 60";
            } else if (mat === 'aac') { // B√™ t√¥ng kh√≠
                if (dim >= 200) rating = "REI 240";
                else if (dim >= 200) rating = "REI 180";
                else if (dim >= 150) rating = "REI 120"; // X·∫•p x·ªâ
                else if (dim >= 150) rating = "REI 90";
                else if (dim >= 100) rating = "REI 60";
            }
        }

        if (rating !== "Kh√¥ng ƒë·∫°t") color = "#137333"; // green

        resDiv.innerHTML = `
            <div class="calc-box" style="border-left: 5px solid ${color}; padding:15px;">
                <div style="font-size:16px;">K·∫øt qu·∫£ tra c·ª©u s∆° b·ªô (Ph·ª• l·ª•c F):</div>
                <div style="font-size:24px; font-weight:bold; color:${color};">${rating}</div>
                <div style="font-size:12px; margin-top:5px; font-style:italic;">
                    * L∆∞u √Ω: K·∫øt qu·∫£ n√†y d·ª±a tr√™n s·ªë li·ªáu tra b·∫£ng ƒë·ªãnh danh (danh ƒë·ªãnh) theo k√≠ch th∆∞·ªõc v√† l·ªõp b·∫£o v·ªá. <br>
                    * Trong th·ª±c t·∫ø c·∫ßn xem x√©t s∆° ƒë·ªì ch·ªãu l·ª±c, t·ª∑ s·ªë t·∫£i tr·ªçng v√† lo·∫°i c·ªët li·ªáu c·ª• th·ªÉ.
                </div>
            </div>
        `;
    }

    function switchSubTab(btn, tabId) {
        // Hide all subtabs
        document.getElementById('tab-req-struct').style.display = 'none';
        document.getElementById('tab-check-struct').style.display = 'none';
        // Deactivate btns
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        // Activate current
        document.getElementById(tabId).style.display = 'block';
        btn.classList.add('active');
        
        // Trigger material update on switch to ensure correct state
        if(tabId === 'tab-check-struct') updateFMaterial();
    }

    // --- LOGIC M·ªöI: T√çNH C·∫§U KI·ªÜN ---
    function calcStructureLimit() {
        const grade = document.getElementById('sel-struct-grade').value;
        const resDiv = document.getElementById('struct-result');
        if (!grade) { resDiv.style.display = 'none'; return; }
        
        let r="", e="", rei_floor="", re_roof="", rei_stair="";
        switch(grade) {
            case 'I': r="R 120"; e="E 30"; rei_floor="REI 60"; re_roof="RE 30"; rei_stair="REI 120"; break;
            case 'II': r="R 90"; e="E 15"; rei_floor="REI 45"; re_roof="RE 15"; rei_stair="REI 90"; break;
            case 'III': r="R 45"; e="E 15"; rei_floor="REI 45"; re_roof="RE 15"; rei_stair="REI 60"; break;
            case 'IV': r="R 15"; e="E 15"; rei_floor="REI 15"; re_roof="RE 15"; rei_stair="REI 45"; break;
            case 'V': r="-"; e="-"; rei_floor="-"; re_roof="-"; rei_stair="-"; break;
        }

        resDiv.style.display = 'block';
        resDiv.innerHTML = `
            <div class="report-card" style="border-left: 5px solid #0b57d0;">
                <div class="report-header">
                    <div class="report-title">Y√äU C·∫¶U GI·ªöI H·∫†N CH·ªäU L·ª¨A (B·∫¨C ${grade})</div>
                    <button class="mini-cite-btn" onclick='openDocViewer([{page:26, label:"B·∫£ng 4 - QCVN 06:2022", highlights:["${grade}"]}] )'>üìñ Xem B·∫£ng 4</button>
                </div>
                <table class="report-table">
                    <tr><td>B·ªô ph·∫≠n ch·ªãu l·ª±c (C·ªôt, D·∫ßm, K√®o):</td><td class="val-highlight">${r}</td></tr>
                    <tr><td>T∆∞·ªùng ngo√†i kh√¥ng ch·ªãu l·ª±c:</td><td class="val-highlight">${e}</td></tr>
                    <tr><td>S√†n gi·ªØa c√°c t·∫ßng:</td><td class="val-highlight">${rei_floor}</td></tr>
                    <tr><td>M√°i (kh√¥ng c√≥ t·∫ßng √°p m√°i):</td><td class="val-highlight">${re_roof}</td></tr>
                    <tr><td>T∆∞·ªùng bu·ªìng thang b·ªô:</td><td class="val-highlight">${rei_stair}</td></tr>
                </table>
            </div>
        `;
    }

    // --- C√ÅC H√ÄM LOGIC KH√ÅC (GI·ªÆ NGUY√äN) ---
    function calcDoorFireLimit() {
        const type = document.getElementById('sel-barrier-type').value;
        const resDiv = document.getElementById('door-result');
        if(!type){ resDiv.style.display='none'; return; }
        resDiv.style.display='block';
        let d="", v="";
        if(type=='W1'||type=='F1'){d="Lo·∫°i 1"; v="EI 60";}
        else if(type=='P2'||type=='F4'){d="Lo·∫°i 3"; v="EI 15";}
        else {d="Lo·∫°i 2"; v="EI 30";}
        resDiv.innerHTML=`<div class="calc-box" style="border-left:5px solid #b91c1c;background:#fff5f5;padding:15px;"><div style="font-size:16px;">Y√™u c·∫ßu:</div><div style="font-size:24px;font-weight:bold;color:#b91c1c;">${d} - ${v}</div></div>`;
    }

    function calcStaircase() {
        const h = parseFloat(document.getElementById('thang-h').value)||0;
        const f = document.getElementById('thang-func').value;
        let t="L1/L2", n="2 thang";
        if(h>28){ t = (f==='F1.3') ? "N1" : "N2/N3"; }
        if((f==='F1.3' && h<=75) || h<=15) n = "C√≥ th·ªÉ 1 thang (x√©t ƒëk)";
        document.getElementById('thang-result').style.display='block';
        document.getElementById('thang-result').innerHTML=`<div class="calc-box">Lo·∫°i: <b>${t}</b><br>SL: <b>${n}</b></div>`;
    }

    function calcMaterialCV() {
        // Logic ƒë∆°n gi·∫£n h√≥a ƒë·ªÉ demo
        document.getElementById('cv-result').style.display='block';
        document.getElementById('cv-result').innerHTML=`<div class="calc-box">K·∫øt qu·∫£: <b>CV1</b> (Demo)</div>`;
    }

    function calcHazardClass() {
        const r = document.querySelector('input[name="hazard_q"]:checked');
        const d = document.getElementById('hazard-result'); d.style.display='block';
        if(r) d.innerHTML=`<div class="calc-box">H·∫°ng: <b>${r.value}</b></div>`;
        else d.innerHTML=`<div class="calc-box" style="color:red">Vui l√≤ng ch·ªçn!</div>`;
    }

    function checkThamDuyet() {
        const f = parseInt(document.getElementById('td-floors').value)||0;
        const v = parseFloat(document.getElementById('td-volume').value)||0;
        const t = document.getElementById('td-type').value;
        let req=false;
        if(t==='apartment' && (f>=7 || v>=5000)) req=true;
        // ... th√™m logic
        const d = document.getElementById('td-result'); d.style.display='block';
        d.innerHTML = req ? `<div class="calc-box" style="color:#c5221f;background:#fce8e6">üî• THU·ªòC DI·ªÜN TH·∫®M DUY·ªÜT</div>` : `<div class="calc-box" style="color:#137333;background:#e6f4ea">‚úÖ KH√îNG THU·ªòC DI·ªÜN (TH∆Ø·ªúNG)</div>`;
    }

    function checkExitCount() {
        const h=parseFloat(document.getElementById('exit-calc-height').value)||0;
        const d=document.getElementById('exit-count-result'); d.style.display='block';
        if(h<=15) d.innerHTML=`<div class="calc-box" style="color:#137333">‚úÖ C√≥ th·ªÉ 1 l·ªëi (x√©t ƒëk kh√°c)</div>`;
        else d.innerHTML=`<div class="calc-box" style="color:#c5221f">‚ö†Ô∏è Y√™u c·∫ßu 2 l·ªëi</div>`;
    }

    function checkRoadAccess() {
        const w=parseFloat(document.getElementById('check-road-width').value)||0;
        const h=parseFloat(document.getElementById('check-road-height').value)||0;
        document.getElementById('road-result').style.display='block';
        document.getElementById('road-result').innerHTML = (w>=3.5 && h>=4.5) ? "‚úÖ ƒê·∫°t" : "‚ùå Kh√¥ng ƒë·∫°t";
    }

    function filterTable(tableId, inputId) {
        var input = document.getElementById(inputId);
        var filter = input.value.toUpperCase();
        var table = document.getElementById(tableId);
        var tr = table.getElementsByTagName("tr");
        for (var i = 0; i < tr.length; i++) {
            var td = tr[i].getElementsByTagName("td")[0];
            var td2 = tr[i].getElementsByTagName("td")[1];
            if (td || td2) {
                var txtValue = (td ? td.textContent || td.innerText : "") + (td2 ? td2.textContent || td2.innerText : "");
                if (txtValue.toUpperCase().indexOf(filter) > -1) tr[i].style.display = ""; else tr[i].style.display = "none";
            }
        }
    }

    function openDocViewer(citations) {
        const m = document.getElementById('doc-modal');
        const c = document.getElementById('doc-viewer-content');
        c.innerHTML='';
        citations.forEach(cit => {
            const div = document.createElement('div'); div.className='doc-page';
            let txt = qcvnPages[cit.page] || "(ƒêang c·∫≠p nh·∫≠t)";
            if(cit.highlights) cit.highlights.forEach(h => { txt = txt.replace(new RegExp(`(${h})`,'gi'), '<mark class="highlight">$1</mark>'); });
            div.innerHTML = txt;
            c.appendChild(div);
        });
        m.style.display='flex';
    }
    function closeDocViewer(){ document.getElementById('doc-modal').style.display='none'; }
    function showTab(id, el){
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
        el.classList.add('active');
    }
    function toggleRiskInput(){ const f=document.getElementById('inp-function').value; document.getElementById('risk-container').style.display=f.startsWith('F5')?'block':'none'; }
    function toggleKcRisk(){ const f=document.getElementById('sel-kc-func').value; document.getElementById('kc-risk-group').style.display=f.startsWith('F5')?'block':'none'; }
    function calcKhoangChay() { /* ... */ } // (Gi·ªØ logic c≈©)
    function runCheckAll() { /* ... */ } // (Gi·ªØ logic c≈©)
    
    // Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
    updateFMaterial();
</script>
</body>
</html>
